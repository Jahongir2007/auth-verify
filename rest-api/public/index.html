<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auth-verify REST API Guide</title>

  <!-- Tailwind + DaisyUI (dark mode) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />

  <!-- Highlight.js (Monokai-Sublime) -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai-sublime.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <style>
    pre code { @apply rounded-lg p-4 overflow-x-auto; }
    .copy-btn { @apply btn btn-xs btn-ghost absolute top-2 right-2; }
  </style>
</head>

<body class="bg-base-100 text-base-content min-h-screen">

  <!-- Header -->
  <header class="bg-primary text-primary-content py-12">
    <div class="container mx-auto text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-3">Auth-verify REST API Guide</h1>
      <p class="text-lg opacity-90">
        Generate, send (Gmail / SMS) and verify OTPs ‚Äì examples in 6 languages
      </p>
    </div>
  </header>

  <div class="container mx-auto px-4 py-10">

    <!-- Intro -->
    <section class="prose prose-invert max-w-none mb-12">
      <h2>Overview</h2>
      <p>All requests go to <code class="bg-base-300 px-2 py-1 rounded">https://auth-verify-sy2y.onrender.com/</code> (replace with your production URL).</p>
      <ul class="list-disc pl-6">
        <li><strong>Generate:</strong> <code>POST /auth/otp/generate/{length}</code></li>
        <li><strong>Gmail:</strong> <code>POST /auth/otp/send/gmail/{to_email}</code></li>
        <li><strong>SMS:</strong> <code>POST /auth/otp/send/sms/{to_phone}</code></li>
        <li><strong>Verify:</strong> <code>POST /auth/otp/verify/{to}</code></li>
      </ul>
      <div class="alert alert-info mt-4">
        <strong>Never</strong> hard-code credentials. Use environment variables (shown in each example).
      </div>
    </section>

    <!-- Language Tabs -->
    <div class="tabs tabs-boxed mb-6">
      <a class="tab tab-active" data-lang="python">Python</a>
      <a class="tab" data-lang="php">PHP</a>
      <a class="tab" data-lang="go">Go</a>
      <a class="tab" data-lang="java">Java</a>
      <a class="tab" data-lang="csharp">C#</a>
      <a class="tab" data-lang="ruby">Ruby</a>
    </div>

    <!-- Code Panels -->
    <div id="code-panels" class="space-y-8">

      <!-- ==================== PYTHON ==================== -->
      <div class="panel" data-lang="python">
        <h3 class="text-2xl font-semibold mb-3">Python (requests)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-python">import os
import os
import requests
from dotenv import load_dotenv   # pip install python-dotenv

load_dotenv()

BASE_URL = os.getenv("OTP_BASE_URL", "http://localhost:3000/api")

# For Gmail
GMAIL_USER = os.getenv("GMAIL_USER")
GMAIL_PASS = os.getenv("GMAIL_APP_PASS")

# For SMTP
SMTP_USER = os.getenv("SMTP_USER")
SMTP_PASS = os.getenv("SMTP_PASS")
SMTP_HOST = os.getenv("SMTP_HOST")
SMTP_PORT = os.getenv("SMTP_PORT")

# For SMS
SMS_PROVIDER = os.getenv("SMS_PROVIDER")        # twilio | nexmo | etc
SMS_KEY = os.getenv("SMS_KEY")
SMS_SECRET = os.getenv("SMS_SECRET")
SMS_SENDER = os.getenv("SMS_SENDER")


# ---------------------------------------------
# üîπ Generate OTP (REST: /auth/otp/generate/:len)
# ---------------------------------------------
def generate_otp(length=6):
    r = requests.post(f"{BASE_URL}/auth/otp/generate/{length}")
    r.raise_for_status()
    return r.json()


# ---------------------------------------------
# üîπ Send OTP via Gmail (REST: /auth/otp/send/gmail/:to)
# ---------------------------------------------
def send_otp_gmail(to_email, otp):
    payload = {
        "sender": {
            "email": GMAIL_USER,
            "pass": GMAIL_PASS,
            "subject": "Your OTP Code",
            "text": f"Your OTP is {otp}",
            "html": f"<b>Your OTP is {otp}</b>"
        }
    }

    r = requests.post(f"{BASE_URL}/auth/otp/send/gmail/{to_email}", json=payload)
    r.raise_for_status()
    return r.json()


# -------------------------------------------------
# üîπ Send OTP via SMTP Email (REST: /auth/otp/send/email/:to)
# -------------------------------------------------
def send_otp_smtp(to_email, otp):
    payload = {
        "sender": {
            "email": SMTP_USER,
            "pass": SMTP_PASS,
            "host": SMTP_HOST,
            "port": int(SMTP_PORT),
            "secure": False,
            "subject": "Your OTP Code",
            "text": f"Your OTP is {otp}",
            "html": f"<h2>Your OTP is <b>{otp}</b></h2>"
        }
    }

    r = requests.post(f"{BASE_URL}/auth/otp/send/email/{to_email}", json=payload)
    r.raise_for_status()
    return r.json()


# -------------------------------------------------
# üîπ Send OTP via SMS (REST: /auth/otp/send/sms/:to)
# -------------------------------------------------
def send_otp_sms(phone, otp):
    payload = {
        "sender": {
            "provider": SMS_PROVIDER,
            "apiKey": SMS_KEY,
            "apiSecret": SMS_SECRET,
            "sender": SMS_SENDER,
            "text": f"Your OTP is {otp}"
        }
    }

    r = requests.post(f"{BASE_URL}/auth/otp/send/sms/{phone}", json=payload)
    r.raise_for_status()
    return r.json()


# ---------------------------------------------
# üîπ Verify OTP (REST: /auth/otp/verify/:to)
# ---------------------------------------------
def verify_otp(to, otp):
    r = requests.post(f"{BASE_URL}/auth/otp/verify/{to}", json={"otp": otp})
    r.raise_for_status()
    return r.json()


# ---------------------------------------------
# ‚ñ∂Ô∏è MAIN TEST
# ---------------------------------------------
if __name__ == "__main__":
    # Generate OTP
    data = generate_otp()
    otp = data.get("code")
    print("Generated OTP:", otp)

    # Send Gmail
    # send_otp_gmail("test@gmail.com", otp)

    # Send SMTP
    # send_otp_smtp("test@gmail.com", otp)

    # Send SMS
    # send_otp_sms("+998901234567", otp)

    # Verify OTP
    # print(verify_otp("test@gmail.com", otp))
</code></pre>
        </div>
      </div>

      <!-- ==================== PHP ==================== -->
      <div class="panel hidden" data-lang="php">
        <h3 class="text-2xl font-semibold mb-3">PHP (cURL)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-php">&lt;?php
putenv('GMAIL_USER=jahongir.nodirovich.2007@gmail.com');
putenv('GMAIL_APP_PASS=YOUR_APP_PASSWORD');
putenv('TEST_EMAIL=jahongir.sobirov.2007@mail.ru');

$BASE_URL = getenv('OTP_BASE_URL') ?: 'http://localhost:3000/api';

function post($url, $data = null) {
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_HTTPHEADER => ['Content-Type: application/json'],
        CURLOPT_POSTFIELDS => $data ? json_encode($data) : null
    ]);
    $out = curl_exec($ch);
    curl_close($ch);
    return json_decode($out, true);
}

$otp = post("$BASE_URL/auth/otp/generate/6");
echo "OTP: " . $otp['code'] . PHP_EOL;

$payload = [
    "sender" => [
        "email" => getenv('GMAIL_USER'),
        "pass"  => getenv('GMAIL_APP_PASS'),
        "subject"=> "Your OTP Code",
        "text"  => "Your OTP code is: {$otp['code']}",
        "html"  => "&lt;b&gt;Your OTP code is: {$otp['code']}&lt;/b&gt;"
    ]
];
post("$BASE_URL/auth/otp/send/gmail/" . getenv('TEST_EMAIL'), $payload);
</code></pre>
        </div>
      </div>

      <!-- ==================== GO ==================== -->
      <div class="panel hidden" data-lang="go">
        <h3 class="text-2xl font-semibold mb-3">Go (net/http)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-go">package main

import (
	"encoding/json"
	"fmt"
	"net/http"
	"os"
)

var baseURL = os.Getenv("OTP_BASE_URL")
if baseURL == "" { baseURL = "http://localhost:3000/api" }

func postJSON(url string, payload interface{}) map[string]interface{} {
	b, _ := json.Marshal(payload)
	resp, _ := http.Post(url, "application/json", bytes.NewBuffer(b))
	defer resp.Body.Close()
	var out map[string]interface{}
	json.NewDecoder(resp.Body).Decode(&out)
	return out
}

func main() {
	// 1. Generate
	otp := postJSON(fmt.Sprintf("%s/auth/otp/generate/6", baseURL), nil)
	code := otp["code"].(string)
	fmt.Println("OTP:", code)

	// 2. Gmail
	gmailPayload := map[string]interface{}{
		"sender": map[string]string{
			"email":   os.Getenv("GMAIL_USER"),
			"pass":    os.Getenv("GMAIL_APP_PASS"),
			"subject": "Your OTP Code",
			"text":    fmt.Sprintf("Your OTP code is: %s", code),
			"html":    fmt.Sprintf("&lt;b&gt;Your OTP code is: %s&lt;/b&gt;", code),
		},
	}
	postJSON(fmt.Sprintf("%s/auth/otp/send/gmail/%s", baseURL, os.Getenv("TEST_EMAIL")), gmailPayload)
}
</code></pre>
        </div>
      </div>

      <!-- ==================== JAVA ==================== -->
      <div class="panel hidden" data-lang="java">
        <h3 class="text-2xl font-semibold mb-3">Java (HttpClient)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-java">import java.net.URI;
import java.net.http.*;
import java.util.Map;
import com.fasterxml.jackson.databind.ObjectMapper;

public class OTPDemo {
    private static final String BASE = System.getenv("OTP_BASE_URL") != null ?
            System.getenv("OTP_BASE_URL") : "http://localhost:3000/api";
    private static final HttpClient client = HttpClient.newHttpClient();
    private static final ObjectMapper mapper = new ObjectMapper();

    public static void main(String[] args) throws Exception {
        // 1. Generate
        var genReq = HttpRequest.newBuilder()
                .uri(URI.create(BASE + "/auth/otp/generate/6"))
                .POST(HttpRequest.BodyPublishers.noBody())
                .build();
        var genResp = client.send(genReq, HttpResponse.BodyHandlers.ofString());
        @SuppressWarnings("unchecked")
        Map&lt;String,Object&gt; otp = mapper.readValue(genResp.body(), Map.class);
        String code = (String) otp.get("code");
        System.out.println("OTP: " + code);

        // 2. Gmail
        Map&lt;String,Object&gt; sender = Map.of(
            "email", System.getenv("GMAIL_USER"),
            "pass",  System.getenv("GMAIL_APP_PASS"),
            "subject","Your OTP Code",
            "text", "Your OTP code is: "+code,
            "html", "&lt;b&gt;Your OTP code is: "+code+"&lt;/b&gt;"
        );
        var payload = Map.of("sender", sender);
        var gmailReq = HttpRequest.newBuilder()
                .uri(URI.create(BASE + "/auth/otp/send/gmail/" + System.getenv("TEST_EMAIL")))
                .header("Content-Type","application/json")
                .POST(HttpRequest.BodyPublishers.ofString(mapper.writeValueAsString(payload)))
                .build();
        client.send(gmailReq, HttpResponse.BodyHandlers.ofString());
    }
}
</code></pre>
        </div>
      </div>

      <!-- ==================== C# ==================== -->
      <div class="panel hidden" data-lang="csharp">
        <h3 class="text-2xl font-semibold mb-3">C# (HttpClient)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-csharp">using System;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;
using System.Collections.Generic;

class Program {
    static readonly HttpClient client = new HttpClient();
    static readonly string baseUrl = Environment.GetEnvironmentVariable("OTP_BASE_URL") ?? "http://localhost:3000/api";

    static async Task Main() {
        // 1. Generate
        var otpResp = await client.PostAsync($"{baseUrl}/auth/otp/generate/6", null);
        var otpJson = await otpResp.Content.ReadAsStringAsync();
        dynamic otp = JsonConvert.DeserializeObject(otpJson);
        string code = otp.code;
        Console.WriteLine($"OTP: {code}");

        // 2. Gmail
        var sender = new Dictionary&lt;string, string&gt;{
            {"email", Environment.GetEnvironmentVariable("GMAIL_USER")},
            {"pass",  Environment.GetEnvironmentVariable("GMAIL_APP_PASS")},
            {"subject","Your OTP Code"},
            {"text", $"Your OTP code is: {code}"},
            {"html", $"&lt;b&gt;Your OTP code is: {code}&lt;/b&gt;"}
        };
        var payload = new { sender };
        var content = new StringContent(JsonConvert.SerializeObject(payload), Encoding.UTF8, "application/json");
        await client.PostAsync($"{baseUrl}/auth/otp/send/gmail/{Environment.GetEnvironmentVariable("TEST_EMAIL")}", content);
    }
}
</code></pre>
        </div>
      </div>

      <!-- ==================== RUBY ==================== -->
      <div class="panel hidden" data-lang="ruby">
        <h3 class="text-2xl font-semibold mb-3">Ruby (net/http)</h3>
        <div class="relative">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-ruby">require 'net/http'
require 'json'
require 'uri'

BASE   = ENV['OTP_BASE_URL'] || 'http://localhost:3000/api'
GMAIL  = ENV['GMAIL_USER']
PASS   = ENV['GMAIL_APP_PASS']
EMAIL  = ENV['TEST_EMAIL']

def post(uri, payload = nil)
  req = Net::HTTP::Post.new(uri)
  req['Content-Type'] = 'application/json'
  req.body = payload.to_json if payload
  Net::HTTP.start(uri.host, uri.port, use_ssl: uri.scheme == 'https') do |http|
    http.request(req)
  end
end

# 1. Generate
uri = URI("#{BASE}/auth/otp/generate/6")
otp = JSON.parse(post(uri).body)
code = otp['code']
puts "OTP: #{code}"

# 2. Gmail
payload = {
  sender: {
    email: GMAIL,
    pass: PASS,
    subject: 'Your OTP Code',
    text: "Your OTP code is: #{code}",
    html: "&lt;b&gt;Your OTP code is: #{code}&lt;/b&gt;"
  }
}
post(URI("#{BASE}/auth/otp/send/gmail/#{EMAIL}"), payload)
</code></pre>
        </div>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <footer class="footer footer-center p-6 bg-base-300 text-base-content">
    <div>
      <p>Auth-verify REST API Guide <span class="font-bold">by <a class="nav-link" href="https://github.com/Jahongir2007">Jahongir Sobirov</a> &copy; 2025</span></p>
    </div>
  </footer>

  <!-- JS: tab switching + copy -->
  <script>
    // Tab handling
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('tab-active'));
        tab.classList.add('tab-active');

        const lang = tab.getAttribute('data-lang');
        document.querySelectorAll('.panel').forEach(p => {
          p.classList.toggle('hidden', p.getAttribute('data-lang') !== lang);
        });
      });
    });

    // Copy button
    function copyCode(btn) {
      const code = btn.parentElement.querySelector('pre code').innerText;
      navigator.clipboard.writeText(code).then(() => {
        const original = btn.innerHTML;
        btn.innerHTML = 'Copied!';
        setTimeout(() => btn.innerHTML = original, 1500);
      });
    }
  </script>
</body>
</html>
